{% extends 'CP1.html' %}
{% load static %}
{% block content %}
<link href="{% static 'homepage.css' %}" rel="stylesheet" type="text/css">
    <div id="carouselExampleIndicators" class="carousel slide" data-bs-ride="carousel">
        <div class="carousel-indicators">
        <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="0" class="active" aria-current="true" aria-label="Slide 1"></button>
        <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="1" aria-label="Slide 2"></button>
        <button type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide-to="2" aria-label="Slide 3"></button>
    </div>
    <div class="carousel-inner" style="height: 400px">
        <div class="carousel-item active">
        <img src="https://mmc.tirto.id/image/otf/500x0/2020/03/18/istock-1089940388_ratio-16x9.jpg" class="d-block w-100" alt="Image1">
        </div>
        <div class="carousel-item">
        <img src="https://www.akseleran.co.id/blog/wp-content/uploads/2018/05/Akseleran_Article_Featured_Image_1366x768_investasiamanmenguntungkan.jpg" class="d-block w-100" alt="Image2">
        </div>
        <div class="carousel-item">
        <img src="https://cdn1-production-images-kly.akamaized.net/fwEaScKsHQjf_ncBoNEeSePAQT4=/673x373/smart/filters:quality(75):strip_icc():format(jpeg)/kly-media-production/medias/1053722/original/057113800_1447401149-20151113-Ilustrasi-Investasi-3.jpg" class="d-block w-100" alt="Image3">
        </div>
    </div>
    <button class="carousel-control-prev" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="prev">
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Previous</span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#carouselExampleIndicators" data-bs-slide="next">
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Next</span>
    </button>
    </div>
    <div class="card" style="width: 30rem; background-color: #bdc9f6; box-shadow: 0 0px 20px 0 rgba(0,0,0,0.2) text-align: left; position=absolute;">
    <div class="card-body">
        <h5 class="card-title">Tentang Kami</h5>
        <p id="isi" class="card-text">YukInvest merupakan platform yang menyediakan layanan berinvestasi yang menghubungkan para investor dengan berbagai jenis UMKM di Indonesia. YukInvest dapat memberikan bantuan untuk mendorong masyarakat Indonesia untuk berinvestasi kepada UMKM demi memajukan perekonomian Indonesia.</p>
    </div>
    </div>
    <div class="logo">
        <img src="https://i.ibb.co/vBwD05C/Group-15.png" alt="..." style="position: absolute; width: 246px; height: 205px; left: 247px; top: 550px;">
    <div class="tulisan" style="color: black">
        <h5 class="judul">Investasi UMKM</h5>
        <p class="text">Lihat daftar investasi bisnis yang sedang berlangsung dan temukan peluang untuk berinvestasi hari ini.</p>
        <a href="/pasarsaham/"><button class="button-lihat">Lihat Daftar Saham UMKM</button></a>
    </div>
    {% comment %} <div class="card-columns" style="display: grid;grid-template-columns: repeat(3, 1fr);">
        {% for umkm in umkm %}
        <div class="card1">
            <div class="card_image overlay text-center">
                    <img class="card-img-top" src="{{ umkm.gambar_usaha }}" alt="ajg">
            </div>
            <div class="card-body1 card-body-cascade">
                <h4 class="card-title"><strong><a href="{% url 'homepage:detailsaham'%}" style= "color: blue">{{umkm.merek_bisnis}}</a></strong></h4>
                <!-- Card Domisili-->
                <p class="card-domisili">{{umkm.domisili}}</p>
                <div class="card-footer">
                    <p>Nilai Bisnis</p>
                    <p>Rp. {{umkm.pendanaan_dibutuhkan}}</p>
                </div>
            </div>
        </div>
        {% endfor %} {% endcomment %}

    <div class="tulisan2" style="color: black">
        <h5 class="judul2" style="margin-top: 50px;">Daftar UMKM</h5>
        <p class="text2">Tentukan pilihan bisnis-bisnis yang sesuai dengan keinginan Anda!</p>
        <a href="/daftarumkm/"><button class="button-lihat">Lihat Daftar UMKM</button></a>
    </div>

    <div class="row gx-1" style="margin-top: 50px;">
                    {% for feedback in feedbacks %}
                    <div class="col-lg-3 mb-5">
                        <div class="cardd h-100 shadow border-0">
                            <img class="card-img-top" src="https://assets-pergikuliner.com/sqeBmGdvhtlCRg2Mxka5588NLYY=/fit-in/1366x768/smart/filters:no_upscale()/https://assets-pergikuliner.com/uploads/image/picture/1920689/picture-1586842045.jpg" alt="..." />
                            <div class="card-footer p-4 pt-0 bg-transparent border-top-0">
                                <div class="d-flex align-items-end justify-content-between">
                                    <div class="d-flex align-items-center">
                                        <img class="rounded-circle me-3" src="https://dummyimage.com/40x40/ced4da/6c757d" alt="..." />
                                        <div class="small">
                                            <div class="fw-bold">Rasyad Nurhakim</div>
                                            <div class="text-muted">"Saya jadi terbantu dengan adanya YUK!Invest" - Pengusaha UMKM</div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% endfor %}
                </div>
            </section>
            <!-- gatau dah section-->
            <div class="py-5 bg-light">
                <div class="container px-5 my-5">
                    <div class="row gx-5 justify-content-center">
                        <div class="col-lg-10 col-xl-7">
                            <div class="text-center">
                                <div class="fs-4 mb-4 fst-italic">"YukInvest dapat memberikan bantuan untuk mendorong masyarakat Indonesia untuk berinvestasi kepada UMKM demi memajukan perekonomian Indonesia."</div>
                                <div class="d-flex align-items-center justify-content-center">
                                    <img class="rounded-circle me-3" src="https://dummyimage.com/40x40/ced4da/6c757d" alt="..." />
                                    <div class="fw-bold">
                                        Alya Annissa
                                        <span class="fw-bold text-primary mx-1">/</span>
                                        CEO, YukInvest!
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Testimonial section-->
            <section class="py-0" id="features">
                <div class="container px-5 my-4">
                    <div class="row gx-5">
                        <div class="col-lg-4 mb-5 mb-lg-0"><h4 class="fw-bolder mb-0">Pesan dari Pengguna Kami</h4></div>
                        <div class="col-lg-8">
                            <div class="row gx-5 row-cols-1 row-cols-md-2"> 
                                {% for feedback in feedbacks %}
                                <div class="col mb-5 h-100">
                                    <div class="feature bg-primary bg-gradient text-white rounded-3 mb-3"><i class="bi bi-collection"></i></div>
                                    <h2 class="h5">{{feedback.pengirim}} </h2>
                                    <p class="mb-0">{{feedback.message}}</p>
                                </div>
                                {% endfor %}
                            </div>  
                        </div>
                    </div>
                </div>
            </section>

            <!-- Blog preview section-->
            <section class="py-0">
                <div class="container px-5 my-3">
                        <div class ='Form Feedback'></div>
                        <h4 class="fw-bolder mb-0">Beri Kami Ulasan</h4>
                        <br> 
                        <form action="" method="post" class="form-control" style="height: calc(1.5em + 35rem + 2px) !important; background-color: #bdc9f6;">
                            {% csrf_token %}
                            <ul class="ratingscale" style="list-style-type:none;">
                                <br> 
                                <label>Pengirim</label>
                                <li id="pengirim" class="pengirim">{{ form.pengirim }}</li>
                                <br> 
                                <label>Message</label>
                                <li id="message" class="message">{{ form.message }}</li>
                                <br> 
                                <label>Ratings</label>
                                <li id="ratings" class="ratings">{{ form.ratings }}</li>
                                <br> 
                                <button type="submit" class="btn btn-primary">Submit</button>  
                            </ul> 
                        </form>        
                        </div>

        {% if user.is_authenticated %}
        <div class="w-100 d-flex justify-content-center" style="margin-top: 0px">
            <table class="table w-75">
                <thead>
                <tr>
                    <th scope="col">Timefield</th>
                    <th scope="col">Message</th>
                    <th scope="col">Ratings</th>
                    <th scope="col">Actions</th>
                </tr>
                </thead>
                <tbody>
                    {% if feedbacksAll %}
                        {% for history in feedbacksAll %}
                            <tr>
                                <td>{{ history.created_at }}</td>
                                <td>{{ history.message}}</td>
                                <td>{{ history.ratings }}</td>
                                <td>
                                <form action="" method="POST">
                                {% csrf_token %}
                                    <button type="button" type="button" class="btn btn-secondary" data-bs-toggle="modal" data-bs-target="#exampleModal" data-message={{ history.message }} data-ratings={{ history.ratings }} data-pk={{ history.pk }} style="background-color:gray !important;">Edit</button>
                                    <button type="submit" pk={{ history.pk }} class="delete-feedback btn btn-danger">Delete</button>
                                    </form>
                                </td>
                                
                            </tr>
                        {% endfor %}
                    {% endif %}
                </tbody>
            </table>
    
            <div class="modal fade" id="exampleModal" data-bs-backdrop="static" data-bs-keyboard="false" tabindex="-1" aria-labelledby="staticBackdropLabel" aria-hidden="true">
                <div class="modal-dialog modal-dialog-centered">
                    <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="staticBackdropLabel">Edit</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        {% csrf_token %}
                        <div class="mb-3">
                            <label for="exampleFormControlInput1" class="form-label">Message</label>
                            <input type="textarea" class="form-control message" id="modal_message" value="" placeholder="Type message">
                        </div>
                        <div class="mb-3">
                            <label for="exampleFormControlInput1" class="form-label">Ratings</label>
                            <select name="ratings" class="form-control ratings" id="modal_ratings" value ="">
                                <option value="1">1</option>
                                <option value="2">2</option>
                                <option value="3">3</option>
                                <option value="4">4</option>
                                <option value="4">5</option>
                            </select>
                        </div>
                    </div>
                    <div class="modal-footer">
                        <button type="submit" pk="" id="edit-feedback" class="edit-feedback btn btn-primary">Save</button>
                    </div>
                    </div>
                </div>
            </div>
    
            <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
            <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
    
            <script>
                var exampleModal = document.getElementById('exampleModal')
                exampleModal.addEventListener('show.bs.modal', function (event) {
                    // Button that triggered the modal
                    var button = event.relatedTarget
                    // Extract info from data-* attributes
                    var message = button.getAttribute('data-message')
                    var ratings = button.getAttribute('data-ratings')
                    var pk = button.getAttribute('data-pk')
    
                    // If necessary, you could initiate an AJAX request here
                    // and then do the updating in a callback.
                    
                    // Get the modal's content.
                    var modalBodyMessage = exampleModal.querySelector('.modal-body .message')
                    var modalBodyRatings = exampleModal.querySelector('.modal-body .ratings')
                    var modalSaveButton = exampleModal.getElementsByClassName("edit-feedback")
    
                
                    modalBodyMessage.value = message
                    modalBodyRatings.value = ratings
                    modalSaveButton.pk = pk
                })
    
                function getCookie(cname) {
                    let name = cname + "=";
                    let decodedCookie = decodeURIComponent(document.cookie);
                    let ca = decodedCookie.split(';');
                    for(let i = 0; i <ca.length; i++) {
                        let c = ca[i];
                        while (c.charAt(0) == ' ') {
                            c = c.substring(1);
                        }
                        if (c.indexOf(name) == 0) {
                            return c.substring(name.length, c.length);
                        }
                    }
                    return "";
                }
    
                $(document).ready(function(){
                    $("edit-feedback").click(function() {
                        $.ajax({
                            url: '{% url "homepage:edit_feedback" %}',
                            method: "POST",
                            headers: {
                                "X-CSRFToken": getCookie("csrftoken")
                            },
                            data: {
                                "id": exampleModal.getElementsByClassName("edit-feedback").pk,
                                "message": document.getElementById('modal_message').value,
                                "ratings": document.getElementById('modal_ratings').value,
                            },
                            success: function(result){
                                location.reload();
                            },
                            error: function (err) {
                                console.error(err)
                            }
                        })
                    })
    
                    $(".delete-feedback").click(function(){
                        $.ajax({
                            url: '{% url "homepage:delete_feedback" %}',
                            method: "POST",
                            headers: {
                                "X-CSRFToken": getCookie("csrftoken")
                            },
                            data: {
                                "id": $(this).attr('pk')
                            },
                            success: function(result){
                                location.reload();
                            },
                            error: function (err) {
                                console.error(err)
                            }
                        });
                    });
                });
            </script>
        </div>
    
        {% endif %}
{% endblock content %}